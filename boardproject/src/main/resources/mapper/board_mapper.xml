<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.miok.dao.BoardDAO">
	<sql id="includeBoard">
		WHERE BRDDELETEFLAG='N'
		<if test="searchKeyword!=null and searchKeyword!='' and searchType!=''">
			<foreach item="item" index="index" collection="searchTypeArr">
				AND ${item} LIKE CONCAT('%', #{searchKeyword},'%' )
			</foreach>
		</if>
    </sql>
	
	<select id="selectBoardCount" resultType="int" parameterType="com.miok.common.SearchVO">
		SELECT COUNT(*)
		FROM TBL_BOARD
		<include refid="includeBoard" />
	</select>
	
	<select id="selectBoardList" resultType="com.miok.vo.BoardVO" parameterType="com.miok.common.SearchVO">
		SELECT BRDNO, BRDTITLE,
		BRDWRITER, DATE_FORMAT(BRDDATE,'%Y-%m-%d') BRDDATE, BRDHIT
		FROM board.TBL_BOARD
		<include refid="includeBoard" />
		ORDER BY BRDNO DESC
		LIMIT ${rowStart -1}, ${displayRowCount}
	</select>

	<insert id="insertBoard" parameterType="com.miok.vo.BoardVO">
		INSERT INTO TBL_BOARD(BRDTITLE, BRDWRITER, BRDMEMO, BRDDATE, BRDHIT, BRDDELETEFLAG)
		VALUES
		(#{brdtitle}, #{brdwriter}, #{brdmemo}, NOW(), 0, 'N' )
	</insert>

	<update id="updateBoard" parameterType="com.miok.vo.BoardVO">
		UPDATE TBL_BOARD
		SET BRDTITLE=#{brdtitle}
		, BRDWRITER=#{brdwriter}
		, BRDMEMO=#{brdmemo}
		WHERE BRDDELETEFLAG='N'
		AND BRDNO=#{brdno}
	</update>

	<select id="selectBoardOne" parameterType="int" resultType="com.miok.vo.BoardVO">
		SELECT BRDNO, BRDTITLE, BRDWRITER, BRDMEMO,
		DATE_FORMAT(BRDDATE,'%Y-%m-%d') BRDDATE
		FROM board.TBL_BOARD
		WHERE BRDNO=#{brdno}
	</select>

	<update id="deleteBoardOne" parameterType="int">
		UPDATE TBL_BOARD
		SET BRDDELETEFLAG = 'Y'
		WHERE BRDNO=#{brdno}
	</update>
	
	<update id="updateBoardHit" parameterType="int">
		UPDATE TBL_BOARD
		SET BRDHIT = BRDHIT + 1
		WHERE BRDNO = #{brdno}
	</update>
	
</mapper>
